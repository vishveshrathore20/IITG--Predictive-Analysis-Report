<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>LinkedIn Profile Parser</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body {
      font-family: Arial;
      padding: 20px;
    }

    textarea {
      width: 100%;
      height: 300px;
      margin-bottom: 10px;
    }

    button {
      padding: 10px 20px;
      margin-right: 10px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      display: none;
    }

    table,
    th,
    td {
      border: 1px solid #ccc;
    }

    th,
    td {
      padding: 8px;
      vertical-align: top;
      text-align: left;
      white-space: pre-wrap;
    }
  </style>
</head>

<body>

  <h2>LinkedIn Recruiter Data Parser</h2>
  <textarea id="rawData" placeholder="Paste LinkedIn Recruiter data here..."></textarea><br />
  <button id="parseBtn">Parse</button>
  <button id="exportBtn">Export to Excel</button>
  <button id="clearBtn">Clear Table</button>

  <table id="outputTable">
    <thead>
      <tr>
        <th>S. No.</th>
        <th>Name</th>
        <th>Experience</th>
        <th>CTC</th>
        <th>Location (State)</th>
        <th>Preferred Location</th>
        <th>Current Company</th>
        <th>Current Designation</th>
        <th>Education</th>
        <th>Email</th>
        <th>Mobile</th>
        <th>Skills</th>
        <th>Remarks</th>
       
      </tr>
    </thead>
    <tbody id="outputBody"></tbody>
  </table>

  <script>
    function sanitize(str) {
      return $('<div>').text(str).html();
    }

    function parseCandidateBlock(text) {
      const cleanedText = text
        .split('\n')
        .filter(line => !line.toLowerCase().includes('enhanced by resume'))
        .join('\n');

      const lines = cleanedText.split('\n').map(line => line.trim()).filter(Boolean);

      const name = lines[0];
      const connectionMatch = lines[1]?.match(/(\d+(?:st|nd|rd|th)? degree connection|Open to work|.*connection)/i);
      const connection = connectionMatch ? connectionMatch[0] : '';

      let title = '', location = '', education = [], experience = [], current_company = '', current_designation = '', ctc = '', skills = [];

      for (let i = 2; i < lines.length; i++) {
        if (lines[i].includes('·')) {
          const parts = lines[i].split('·').map(s => s.trim());
          title = parts[0];

          for (let j = parts.length - 1; j > 0; j--) {
            const loc = parts[j];
            if (
              loc && loc.includes(',') &&
              !/industry|manufacturing|services|solutions|technologies|electronics|business|appliances/i.test(loc)
            ) {
              const locParts = loc.split(',').map(p => p.trim()).filter(Boolean);
              if (locParts.length >= 3) {
                location = locParts[locParts.length - 2];
              } else if (locParts.length === 2) {
                location = locParts[0];
              } else {
                location = locParts[0];
              }
              break;
            }
          }
          break;
        }
      }

      if (!location) {
        for (const line of lines) {
          if (line.includes(',') && line.toLowerCase().includes('india')) {
            const locPart = line.split('·')[0].trim();
            const locParts = locPart.split(',').map(p => p.trim());

            if (locParts.length >= 2) {
              location = locParts.slice(0, 2).join(', ');
            } else {
              location = locPart;
            }
            break;
          }
        }
      }

      const experienceStart = lines.findIndex(l => l.toLowerCase().includes('experience'));
      if (experienceStart !== -1) {
        let i = experienceStart + 1;
        while (i < lines.length && !lines[i].toLowerCase().includes('education')) {
          const role = lines[i];
          const companyLine = lines[i + 1] || '';
          if (!role || !companyLine || companyLine.toLowerCase().includes('education')) break;

          const match = companyLine.match(/at (.*?) ·/);
          const company = match ? match[1] : '';
          const date = companyLine.includes('·') ? companyLine.split('·').pop().trim() : '';

          if (role && company) {
            experience.push({ role, company, date });
          }

          i += 2;
        }

        const presentExp = experience.find(exp => /present/i.test(exp.date));
        if (presentExp) {
          current_designation = presentExp.role.split(' at ')[0].trim(); // ✅ Only title
          current_company = presentExp.company;
        } else if (experience.length > 0) {
          current_designation = experience[0].role.split(' at ')[0].trim(); // ✅ Only title
          current_company = experience[0].company;
        }
      }

      const educationStart = lines.findIndex(l => l.toLowerCase().includes('education'));
      if (educationStart !== -1) {
        let i = educationStart + 1;
        while (i < lines.length && !lines[i].toLowerCase().includes('save to project') && !lines[i].toLowerCase().includes('skills')) {
          if (lines[i]) education.push(lines[i]);
          i++;
        }
      }

      const skillsStart = lines.findIndex(l => l.toLowerCase().includes('skills') || l.toLowerCase().includes('top skills'));
      if (skillsStart !== -1) {
        let i = skillsStart + 1;
        while (i < lines.length && lines[i] && !lines[i].toLowerCase().includes('save to project')) {
          if (/^[A-Za-z].*/.test(lines[i])) skills.push(lines[i]);
          i++;
        }
      }

      const ctcMatch = cleanedText.match(/(?:₹|INR)?\s?[\d,.]+(?:\s?LPA)?/i);
      ctc = ctcMatch ? ctcMatch[0] : '';

      return {
        name: sanitize(name),
        connection: sanitize(connection),
        title: sanitize(title),
        location: sanitize(location),
        current_designation: sanitize(current_designation),
        current_company: sanitize(current_company),
        ctc: sanitize(ctc),
        experiences: experience,
        education: education.map(sanitize),
        skills: skills.map(sanitize)
      };
    }

    $('#parseBtn').click(function () {
      const raw = $('#rawData').val();
      const peopleBlocks = raw.split(/Select\s+/).slice(1);

      const results = peopleBlocks
        .map(parseCandidateBlock)
        .filter(c => c.name && c.name.length < 100 && !c.name.toLowerCase().includes('profile'));

      const $outputTable = $('#outputTable');
      const $outputBody = $('#outputBody');

      const existingRows = $outputBody.find('tr').length; // Count existing rows to continue S.No

      results.forEach((profile, idx) => {
        const serialNumber = existingRows + idx + 1; // Incremental S.No.

        const expFormatted = profile.experiences.map(exp =>
          `${exp.role} at ${exp.company} (${exp.date || 'Date N/A'})`
        ).join('\n');

        const eduFormatted = profile.education.join('\n');
        const skillsFormatted = profile.skills.join(', ');

        $outputBody.append(`
          <tr>
            <td>${serialNumber}</td>
            <td>${profile.name}</td>
            <td>${expFormatted}</td>
            <td>-</td>
            <td>${profile.location}</td>
            <td>-</td>
            <td>${profile.current_company}</td>
            <td>${profile.current_designation}</td>
            <td>${eduFormatted}</td>
            <td>-</td>
            <td>-</td>
            <td>${skillsFormatted}</td>
            <td>-</td>
          </tr>
        `);
      });

      $('#rawData').val(''); // Clear textarea after parsing

      if (results.length > 0) {
        $outputTable.show();
      } else {
        $outputTable.hide();
      }
    });

    $('#exportBtn').click(function () {
      const wb = XLSX.utils.book_new();
      const ws = XLSX.utils.table_to_sheet(document.getElementById('outputTable'));
      XLSX.utils.book_append_sheet(wb, ws, "Candidates");
      XLSX.writeFile(wb, "LinkedIn_Parsed_Profiles.xlsx");
    });

    $('#clearBtn').click(function () {
      $('#outputBody').empty();
      $('#outputTable').hide();
    });
  </script>

</body>

</html>
